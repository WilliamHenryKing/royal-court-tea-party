    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    :root {
      --pink-light: #ffd1e1; --pink-main: #f5a1c0; --pink-deep: #e87aa0;
      --lavender: #d4b8ff; --periwinkle: #a9c7ff; --mint: #b8e986; --mint-dark: #9ed36a;
      --sky: #cfeeff; --peach: #ffd4a8; --cream: #fff8f0; --gold: #ffd700;
      --text-dark: #4a3f5c; --text-light: #7a6b8a; --white: #ffffff;
    }
    html, body { width: 100%; height: 100%; overflow: hidden; font-family: 'Inter', sans-serif; background: linear-gradient(180deg, #ffeef5 0%, #e8f4ff 100%); touch-action: none; }
    #game-container { width: 100%; height: 100%; position: relative; }
    canvas { display: block; touch-action: none; }

    #splash-screen {
      position: fixed; inset: 0; background: linear-gradient(135deg, #fff0f5 0%, #ffe4ec 30%, #ffd1e1 60%, #e8d4f0 100%);
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start; z-index: 1000;
      transition: opacity 0.8s ease, visibility 0.8s ease; overflow-y: auto; overflow-x: hidden;
      padding: 2rem 1rem;
    }
    #splash-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
    .splash-crown-container { position: relative; margin-bottom: 1rem; }
    .splash-crown { font-size: 5rem; animation: crownFloat 3s ease-in-out infinite; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1)); }
    @keyframes crownFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    .splash-title { font-family: 'Dancing Script', cursive; font-size: 2.4rem; color: var(--text-dark); text-shadow: 2px 2px 0 var(--white), 4px 4px 10px rgba(0,0,0,0.1); margin-bottom: 0.3rem; animation: fadeSlideIn 1s ease 0.3s both; }
    .splash-subtitle { font-family: 'Dancing Script', cursive; font-size: 1.3rem; color: var(--pink-deep); margin-bottom: 0.3rem; animation: fadeSlideIn 1s ease 0.5s both; }
    .splash-tagline { font-size: 0.9rem; color: var(--text-light); font-style: italic; margin-bottom: 1rem; animation: fadeSlideIn 1s ease 0.7s both; }
    @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .splash-instruction { background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); padding: 0.8rem 1.2rem; border-radius: 1rem; margin-bottom: 1rem; max-width: 300px; text-align: center; box-shadow: 0 8px 32px rgba(0,0,0,0.1); animation: fadeSlideIn 1s ease 0.9s both; }
    .splash-instruction p { color: var(--text-dark); line-height: 1.5; font-size: 0.9rem; }
    .splash-instruction strong { color: var(--pink-deep); }
    .splash-btn { background: linear-gradient(135deg, var(--pink-main) 0%, var(--lavender) 100%); border: none; padding: 1rem 2.5rem; border-radius: 3rem; color: var(--white); font-family: 'Inter', sans-serif; font-weight: 700; font-size: 1.1rem; cursor: pointer; box-shadow: 0 8px 30px rgba(245, 161, 192, 0.5); transition: all 0.3s ease; animation: btnPulse 2s ease-in-out infinite; touch-action: manipulation; }
    .splash-btn:active { transform: scale(0.97); }
    @keyframes btnPulse { 0%, 100% { box-shadow: 0 8px 30px rgba(245, 161, 192, 0.5); } 50% { box-shadow: 0 8px 50px rgba(245, 161, 192, 0.8); } }
    .splash-footer { margin-top: 1rem; margin-bottom: 1rem; font-size: 0.75rem; color: var(--text-light); opacity: 0.7; animation: fadeSlideIn 1s ease 1.4s both; }
    
    .splash-map {
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      border-radius: 1.2rem;
      padding: 0.6rem;
      margin-bottom: 1rem;
      max-width: 280px;
      width: 90%;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border: 2px solid rgba(255,215,0,0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      touch-action: manipulation;
    }
    .splash-map:hover { border-color: rgba(255,215,0,0.6); }
    .splash-map.zoomed {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 95vw;
      max-height: 85vh;
      width: 500px;
      z-index: 1005 !important;
      padding: 1.2rem;
      border: 3px solid var(--gold);
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      animation: zoomIn 0.3s ease forwards;
      background: rgba(255,255,255,0.98);
    }
    @keyframes zoomIn { 
      from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } 
      to { transform: translate(-50%, -50%) scale(1); opacity: 1; } 
    }
    .splash-map.zoomed .map-title { font-size: 1.5rem; margin-bottom: 0.5rem; }
    .splash-map.zoomed .map-legend { font-size: 0.9rem; margin-top: 0.6rem; }
    .map-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: transparent;
      z-index: 1001;
      animation: fadeIn 0.3s ease;
    }
    .map-overlay.visible { display: block; }
    .map-tap-hint {
      font-size: 0.65rem;
      color: var(--text-light);
      text-align: center;
      margin-top: 0.2rem;
      opacity: 0.8;
    }
    .splash-map.zoomed .map-tap-hint { display: none; }
    .map-close-hint {
      display: none;
      font-size: 0.8rem;
      color: var(--text-light);
      text-align: center;
      margin-top: 0.5rem;
    }
    .splash-map.zoomed .map-close-hint { display: block; }
    .map-title { 
      font-family: 'Dancing Script', cursive; 
      font-size: 1rem; 
      color: var(--pink-deep); 
      text-align: center; 
      margin-bottom: 0.2rem; 
    }
    .kingdom-map { 
      width: 100%; 
      height: auto; 
      display: block; 
    }
    .map-legend { 
      text-align: center; 
      font-size: 0.7rem; 
      color: var(--text-light); 
      margin-top: 0.3rem; 
      font-style: italic; 
    }

    #loading-screen { position: fixed; inset: 0; background: linear-gradient(135deg, var(--pink-light) 0%, var(--lavender) 50%, var(--sky) 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 900; transition: opacity 0.5s ease, visibility 0.5s ease; }
    #loading-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
    .loading-crown { font-size: 4rem; animation: bounce 1s ease-in-out infinite; }
    .loading-text { font-family: 'Dancing Script', cursive; font-size: 1.8rem; color: var(--text-dark); margin-top: 1rem; text-shadow: 2px 2px 0 var(--white); }
    .loading-subtext { font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem; font-style: italic; }
    .loading-dots { display: flex; gap: 0.5rem; margin-top: 1.5rem; }
    .loading-dots span { width: 12px; height: 12px; background: var(--pink-main); border-radius: 50%; animation: dotPulse 1.4s ease-in-out infinite; }
    .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
    .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes bounce { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-20px) rotate(5deg); } }
    @keyframes dotPulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(0.5); opacity: 0.5; } }

    #hud { position: fixed; top: 0; left: 0; right: 0; padding: 1rem; display: flex; justify-content: space-between; align-items: flex-start; pointer-events: none; z-index: 100; }
    .hud-left, .hud-right { pointer-events: auto; }
    .location-badge { background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); padding: 0.6rem 1rem; border-radius: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: var(--text-dark); font-size: 0.9rem; border: 2px solid rgba(255,255,255,0.5); }
    .location-icon { font-size: 1.2rem; }
    .progress-container { background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); padding: 0.6rem 1rem; border-radius: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border: 2px solid rgba(255,255,255,0.5); }
    .progress-stars { display: flex; gap: 0.3rem; font-size: 1.2rem; }
    .star { opacity: 0.3; transition: all 0.3s ease; filter: grayscale(1); }
    .star.collected { opacity: 1; filter: grayscale(0); animation: starPop 0.5s ease; }
    @keyframes starPop { 0% { transform: scale(1) rotate(0deg); } 50% { transform: scale(1.5) rotate(180deg); } 100% { transform: scale(1) rotate(360deg); } }
    .collectibles-badge { background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); padding: 0.5rem 0.8rem; border-radius: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 0.4rem; font-weight: 600; color: var(--text-dark); font-size: 0.85rem; margin-top: 0.5rem; border: 2px solid rgba(255,215,0,0.3); }
    .music-controls { margin-top: 0.6rem; background: rgba(255,255,255,0.9); backdrop-filter: blur(12px); border-radius: 1.2rem; padding: 0.5rem 0.7rem; box-shadow: 0 4px 18px rgba(0,0,0,0.1); border: 2px solid rgba(255,255,255,0.5); display: flex; flex-direction: column; gap: 0.4rem; }
    .music-title { font-size: 0.75rem; color: var(--text-light); text-align: center; }
    .music-track { font-size: 0.8rem; font-weight: 600; color: var(--text-dark); text-align: center; }
    .music-buttons { display: flex; gap: 0.4rem; justify-content: center; }
    .music-btn { background: linear-gradient(135deg, var(--pink-light) 0%, var(--lavender) 100%); border: none; color: var(--text-dark); font-size: 0.85rem; font-weight: 600; padding: 0.35rem 0.6rem; border-radius: 0.7rem; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .music-btn:active { transform: scale(0.95); }
    .icon-btn { background: rgba(255,255,255,0.9); backdrop-filter: blur(12px); border: 2px solid rgba(255,255,255,0.5); color: var(--text-dark); font-size: 1.2rem; padding: 0.4rem; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-top: 0.4rem; display: flex; align-items: center; justify-content: center; }
    .icon-btn:hover { background: linear-gradient(135deg, var(--pink-light) 0%, var(--lavender) 100%); transform: scale(1.05); }
    .icon-btn:active { transform: scale(0.95); }

    #joystick-container { position: fixed; bottom: 8rem; left: 2rem; width: 110px; height: 110px; z-index: 100; }
    /* Cake-themed joystick base - White frosted cake */
    #joystick-base {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #FFFFFF 0%, #FFF8F0 50%, #FFFAF5 100%);
      border: 3px solid #FFB6C1;
      border-radius: 50%;
      box-shadow:
        0 6px 20px rgba(0,0,0,0.12),
        0 0 15px rgba(255, 182, 193, 0.4),
        inset 0 2px 4px rgba(255, 255, 255, 0.8),
        inset 0 -4px 8px rgba(255, 228, 225, 0.6);
      overflow: visible;
      transition: box-shadow 0.2s ease, transform 0.15s ease;
    }
    #joystick-base.active {
      box-shadow:
        0 6px 20px rgba(0,0,0,0.12),
        0 0 25px rgba(255, 182, 193, 0.6),
        inset 0 2px 4px rgba(255, 255, 255, 0.8),
        inset 0 -4px 8px rgba(255, 228, 225, 0.6);
      transform: scale(1.02);
    }
    /* Frosting texture inner ring */
    #joystick-base::before {
      content: "";
      position: absolute;
      inset: 8px;
      border-radius: 50%;
      border: 2px dashed rgba(255, 182, 193, 0.4);
      box-shadow: inset 0 4px 12px rgba(255, 228, 225, 0.5);
      pointer-events: none;
    }
    /* Frosting highlight on top */
    #joystick-base::after {
      content: "";
      position: absolute;
      inset: 6px 12px auto 12px;
      height: 40%;
      border-radius: 50%;
      background: linear-gradient(180deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 80%);
      opacity: 0.8;
      pointer-events: none;
    }

    /* Direction indicators */
    .joystick-directions {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }
    .joystick-dir {
      position: absolute;
      font-size: 0.9rem;
      opacity: 0.4;
      color: var(--pink-deep);
      transition: opacity 0.15s ease, transform 0.15s ease;
    }
    .joystick-dir.up { top: 8px; left: 50%; transform: translateX(-50%); }
    .joystick-dir.down { bottom: 8px; left: 50%; transform: translateX(-50%); }
    .joystick-dir.left { left: 8px; top: 50%; transform: translateY(-50%); }
    .joystick-dir.right { right: 8px; top: 50%; transform: translateY(-50%); }
    .joystick-dir.active { opacity: 1; transform: scale(1.3); }
    .joystick-dir.up.active { transform: translateX(-50%) scale(1.3); }
    .joystick-dir.down.active { transform: translateX(-50%) scale(1.3); }
    .joystick-dir.left.active { transform: translateY(-50%) scale(1.3); }
    .joystick-dir.right.active { transform: translateY(-50%) scale(1.3); }

    /* Ripple effect */
    .joystick-ripple {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 2px solid var(--pink-main);
      opacity: 0;
      transform: translate(-50%, -50%) scale(0);
      pointer-events: none;
    }
    .joystick-ripple.animate {
      animation: ripple-effect 0.6s ease-out forwards;
    }
    @keyframes ripple-effect {
      0% { opacity: 0.8; transform: translate(-50%, -50%) scale(0.5); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
    }

    /* Cherry-themed joystick thumb */
    #joystick-thumb {
      position: absolute;
      width: 45px;
      height: 45px;
      background: radial-gradient(circle at 35% 35%, #FF6B6B 0%, #E53935 40%, #C62828 70%, #B71C1C 100%);
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow:
        0 4px 8px rgba(0, 0, 0, 0.3),
        0 2px 4px rgba(183, 28, 28, 0.4),
        inset 0 -3px 6px rgba(0, 0, 0, 0.2);
      transition: transform 0.05s ease-out, box-shadow 0.2s ease;
    }
    #joystick-thumb.active {
      box-shadow:
        0 4px 8px rgba(0, 0, 0, 0.3),
        0 2px 4px rgba(183, 28, 28, 0.4),
        inset 0 -3px 6px rgba(0, 0, 0, 0.2),
        0 0 15px rgba(229, 57, 53, 0.6);
      transform: translate(-50%, -50%) scale(1.05);
    }
    /* Cherry shine highlight */
    #joystick-thumb::before {
      content: "";
      position: absolute;
      top: 6px;
      left: 8px;
      width: 12px;
      height: 10px;
      border-radius: 50%;
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 70%);
      pointer-events: none;
    }
    /* Cherry stem */
    #joystick-thumb::after {
      content: "";
      position: absolute;
      top: -10px;
      left: 50%;
      width: 4px;
      height: 14px;
      background: linear-gradient(180deg, #2E7D32 0%, #388E3C 50%, #43A047 100%);
      border-radius: 2px;
      transform: translateX(-50%) rotate(-8deg);
      transform-origin: bottom center;
      pointer-events: none;
      box-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }

    #action-btn { position: fixed; bottom: 8rem; right: 2rem; background: linear-gradient(135deg, var(--mint) 0%, var(--mint-dark) 100%); border: none; border-radius: 2rem; padding: 1rem 1.5rem; font-family: 'Inter', sans-serif; font-weight: 700; font-size: 1rem; color: var(--white); box-shadow: 0 6px 25px rgba(184, 233, 134, 0.5); cursor: pointer; z-index: 150; display: none; align-items: center; gap: 0.5rem; transition: all 0.3s ease; animation: actionPulse 2s ease-in-out infinite; touch-action: manipulation; pointer-events: auto; }
    #action-btn.visible { display: flex; }
    #action-btn:active { transform: scale(0.95); }
    @keyframes actionPulse { 0%, 100% { box-shadow: 0 6px 25px rgba(184, 233, 134, 0.5); transform: translateY(0); } 50% { box-shadow: 0 8px 35px rgba(184, 233, 134, 0.8); transform: translateY(-3px); } }

    #dialog-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); display: none; align-items: flex-end; justify-content: center; z-index: 200; padding: 1rem; }
    #dialog-overlay.visible { display: flex; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    #dialog-box { background: var(--white); border-radius: 1.5rem; padding: 1.5rem; max-width: 400px; width: 100%; max-height: 70vh; overflow-y: auto; box-shadow: 0 -10px 50px rgba(0,0,0,0.25); animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative; }
    @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .dialog-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 2px dashed var(--pink-light); }
    .dialog-avatar { width: 60px; height: 60px; background: linear-gradient(135deg, var(--pink-light) 0%, var(--lavender) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .dialog-speaker { flex: 1; }
    .dialog-name { font-family: 'Dancing Script', cursive; font-size: 1.4rem; color: var(--text-dark); }
    .dialog-role { font-size: 0.85rem; color: var(--text-light); margin-top: 0.2rem; }
    .dialog-content { color: var(--text-dark); line-height: 1.7; font-size: 1rem; }
    .dialog-content h3 { font-family: 'Dancing Script', cursive; color: var(--pink-deep); margin: 1rem 0 0.5rem; font-size: 1.3rem; }
    .dialog-content ul { list-style: none; padding: 0; }
    .dialog-content li { padding: 0.5rem 0; padding-left: 1.5rem; position: relative; }
    .dialog-content li::before { content: 'âœ¿'; position: absolute; left: 0; color: var(--pink-main); }
    .dialog-content .highlight { background: linear-gradient(120deg, var(--pink-light) 0%, var(--lavender) 100%); padding: 0.2rem 0.5rem; border-radius: 0.3rem; font-weight: 600; }
    .dialog-content .detail-card { background: var(--cream); border-radius: 1rem; padding: 1rem; margin: 0.8rem 0; border-left: 4px solid var(--pink-main); }
    .dialog-content .detail-row { display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0; }
    .dialog-content .detail-icon { font-size: 1.2rem; }
    .dialog-content .funny-quote { background: linear-gradient(135deg, var(--sky) 0%, var(--lavender) 100%); border-radius: 1rem; padding: 1rem; margin: 1rem 0; font-style: italic; text-align: center; }
    .dialog-close { position: absolute; top: 1rem; right: 1rem; width: 36px; height: 36px; background: var(--pink-light); border: none; border-radius: 50%; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
    .dialog-close:active { background: var(--pink-main); color: var(--white); }
    .guest-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-top: 0.5rem; }
    .guest-item { background: var(--cream); padding: 0.5rem 0.8rem; border-radius: 0.5rem; font-size: 0.85rem; display: flex; align-items: center; gap: 0.3rem; }
    .speaker-card { background: linear-gradient(135deg, var(--cream) 0%, var(--pink-light) 100%); border-radius: 1rem; padding: 1rem; margin: 0.8rem 0; }
    .speaker-name { font-family: 'Dancing Script', cursive; color: var(--pink-deep); font-size: 1.2rem; }
    .speaker-topic { color: var(--text-light); font-size: 0.9rem; margin-top: 0.3rem; font-style: italic; }

    #minimap { position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.95); backdrop-filter: blur(15px); padding: 0.8rem 1.5rem; border-radius: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); display: flex; gap: 0.8rem; z-index: 90; border: 2px solid rgba(255,255,255,0.5); }
    .map-icon { width: 38px; height: 38px; background: var(--pink-light); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; transition: all 0.3s ease; opacity: 0.5; }
    .map-icon.visited { opacity: 1; background: linear-gradient(135deg, var(--pink-main) 0%, var(--lavender) 100%); }
    .map-icon.current { transform: scale(1.2); box-shadow: 0 0 20px rgba(245, 161, 192, 0.7); }

    #completion-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 400; padding: 1.5rem; }
    #completion-modal.visible { display: flex; }
    .completion-content { background: linear-gradient(135deg, var(--white) 0%, var(--cream) 100%); border-radius: 2rem; padding: 2rem; max-width: 350px; text-align: center; animation: bounceIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative; }
    @keyframes bounceIn { 0% { transform: scale(0.3) rotate(-10deg); opacity: 0; } 50% { transform: scale(1.05) rotate(2deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
    .completion-crown { font-size: 5rem; animation: crownFloat 3s ease-in-out infinite; }
    @keyframes crownFloat { 0%, 100% { transform: translateY(0) rotate(-3deg); } 50% { transform: translateY(-15px) rotate(3deg); } }
    .completion-title { font-family: 'Dancing Script', cursive; font-size: 1.8rem; color: var(--pink-deep); margin: 1rem 0; }
    .completion-text { color: var(--text-dark); line-height: 1.7; margin-bottom: 1.5rem; }
    .rsvp-section { background: linear-gradient(135deg, var(--pink-light) 0%, var(--lavender) 100%); border-radius: 1rem; padding: 1.2rem; margin-top: 1rem; }
    .rsvp-title { font-family: 'Dancing Script', cursive; font-weight: 700; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 1.2rem; }

    #settings-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 500; padding: 1.5rem; }
    #settings-modal.visible { display: flex; }
    .settings-content { background: linear-gradient(135deg, var(--white) 0%, var(--cream) 100%); border-radius: 2rem; padding: 2rem 1.5rem; max-width: 380px; width: 100%; max-height: 90vh; overflow-y: auto; animation: bounceIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative; }
    .settings-title { font-family: 'Dancing Script', cursive; font-size: 1.8rem; color: var(--pink-deep); margin-bottom: 1.5rem; text-align: center; }
    .settings-section { margin-bottom: 1.5rem; padding: 1rem; background: rgba(255,255,255,0.5); border-radius: 1rem; border: 2px solid rgba(255,182,193,0.3); }
    .settings-label { font-weight: 600; color: var(--text-dark); margin-bottom: 0.8rem; font-size: 0.95rem; display: block; }
    .settings-slider { width: 100%; height: 8px; border-radius: 4px; background: linear-gradient(to right, var(--pink-light) 0%, var(--lavender) 100%); outline: none; opacity: 0.8; transition: opacity 0.2s; -webkit-appearance: none; appearance: none; }
    .settings-slider:hover { opacity: 1; }
    .settings-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; background: var(--pink-main); cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .settings-slider::-moz-range-thumb { width: 20px; height: 20px; border-radius: 50%; background: var(--pink-main); cursor: pointer; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .settings-value { text-align: center; color: var(--text-light); font-weight: 600; margin-top: 0.5rem; font-size: 0.9rem; }
    .settings-toggle { position: relative; display: inline-block; width: 54px; height: 28px; }
    .settings-toggle input { opacity: 0; width: 0; height: 0; }
    .settings-toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: 0.3s; border-radius: 28px; }
    .settings-toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: 0.3s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    .settings-toggle input:checked + .settings-toggle-slider { background: linear-gradient(135deg, var(--pink-main) 0%, var(--lavender) 100%); }
    .settings-toggle input:checked + .settings-toggle-slider:before { transform: translateX(26px); }
    .settings-reset-btn { width: 100%; background: linear-gradient(135deg, var(--pink-light) 0%, var(--lavender) 100%); border: none; padding: 0.8rem; border-radius: 1rem; color: var(--text-dark); font-weight: 600; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-top: 0.5rem; }
    .settings-reset-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.15); }
    .settings-reset-btn:active { transform: translateY(0); }

    #intro-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.45); backdrop-filter: blur(6px); display: none; align-items: center; justify-content: center; z-index: 350; padding: 1.5rem; }
    #intro-modal.visible { display: flex; animation: fadeIn 0.3s ease; }
    .intro-card {
      background: linear-gradient(to bottom, #F5E6D3 0%, #FFF8F0 5%, #FFF8F0 95%, #F5E6D3 100%);
      border-radius: 1.5rem;
      padding: 2rem 1.6rem 1.6rem;
      max-width: 320px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(139, 69, 19, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.5), inset 0 -1px 0 rgba(139, 69, 19, 0.1);
      animation: modal-appear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      position: relative;
      overflow: visible;
    }
    @keyframes modal-appear {
      0% { opacity: 0; transform: scale(0.8) translateY(20px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }
    /* Paper texture overlay */
    .intro-card::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 1.5rem;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity: 0.03;
      pointer-events: none;
    }
    /* Wax seal decoration */
    .intro-seal {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 50px;
      background: radial-gradient(circle at 30% 30%, #E74C3C 0%, #C0392B 50%, #922B21 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 4px 12px rgba(192, 57, 43, 0.4), inset 0 -3px 6px rgba(0, 0, 0, 0.2), inset 0 3px 6px rgba(255, 255, 255, 0.1);
      animation: seal-stamp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) 0.3s backwards;
      z-index: 10;
    }
    @keyframes seal-stamp {
      0% { transform: translateX(-50%) scale(2) rotate(-20deg); opacity: 0; }
      100% { transform: translateX(-50%) scale(1) rotate(0deg); opacity: 1; }
    }
    .intro-title { font-family: 'Dancing Script', cursive; font-size: 1.6rem; color: var(--pink-deep); margin-bottom: 0.6rem; margin-top: 0.5rem; }
    .intro-text { color: var(--text-dark); font-size: 0.92rem; line-height: 1.5; }
    .intro-text span { color: var(--pink-deep); font-weight: 600; }
    .intro-btn {
      margin-top: 1rem;
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      border: none;
      border-radius: 50px;
      color: #5D4037;
      font-family: 'Inter', sans-serif;
      font-weight: 700;
      padding: 0.8rem 1.8rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }
    .intro-btn:hover {
      box-shadow: 0 6px 25px rgba(255, 215, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.4);
      transform: scale(1.05);
    }
    .intro-btn:active { transform: scale(0.98); }
    .intro-toggle { margin-top: 1rem; padding: 0.8rem; background: rgba(255,255,255,0.8); border-radius: 1rem; box-shadow: inset 0 0 0 1px rgba(245, 161, 192, 0.4); display: none; }
    .intro-toggle.visible { display: block; }
    .intro-toggle-title { font-weight: 700; color: var(--text-dark); margin-bottom: 0.4rem; }
    .intro-toggle-label { display: flex; align-items: center; gap: 0.6rem; font-size: 0.85rem; color: var(--text-light); justify-content: center; }
    .intro-toggle-label input { accent-color: var(--pink-main); width: 18px; height: 18px; }
    .is-hidden { display: none !important; }
    #keyboard-hints { position: fixed; bottom: 8rem; left: 2rem; padding: 0.6rem 0.9rem; background: rgba(255,255,255,0.95); border-radius: 1rem; box-shadow: 0 6px 20px rgba(0,0,0,0.15); font-size: 0.85rem; color: var(--text-dark); z-index: 100; display: none; max-width: 200px; text-align: left; }
    #keyboard-hints.visible { display: block; }

    #sweet-intro { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(6px); display: none; align-items: center; justify-content: center; z-index: 360; padding: 1.5rem; }
    #sweet-intro.visible { display: flex; animation: fadeIn 0.3s ease; }
    .sweet-card { background: linear-gradient(135deg, var(--white) 0%, var(--cream) 100%); border-radius: 1.4rem; padding: 1.4rem; max-width: 300px; text-align: center; box-shadow: 0 16px 40px rgba(0,0,0,0.25); }
    .sweet-title { font-family: 'Dancing Script', cursive; font-size: 1.5rem; color: var(--pink-deep); margin-bottom: 0.5rem; }
    .sweet-text { color: var(--text-dark); font-size: 0.9rem; line-height: 1.5; }
    .sweet-text span { color: var(--pink-deep); font-weight: 600; }
    .sweet-btn { margin-top: 0.9rem; background: linear-gradient(135deg, var(--mint) 0%, var(--mint-dark) 100%); border: none; color: var(--white); font-weight: 700; padding: 0.6rem 1.4rem; border-radius: 2rem; cursor: pointer; box-shadow: 0 6px 18px rgba(158, 211, 106, 0.5); }

    .floating-message { position: fixed; background: rgba(255,255,255,0.9); padding: 0.4rem 0.7rem; border-radius: 0.5rem; font-size: 0.8rem; color: #444; z-index: 80; animation: floatMsg 2.5s ease-out forwards; pointer-events: none; max-width: 150px; }
    @keyframes floatMsg { 0% { opacity: 0; } 10% { opacity: 0.85; } 75% { opacity: 0.85; } 100% { opacity: 0; } }

    .collect-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, var(--gold) 0%, var(--peach) 100%); padding: 1rem 2rem; border-radius: 2rem; font-weight: 700; color: var(--text-dark); z-index: 150; animation: collectPop 1s ease-out forwards; box-shadow: 0 8px 30px rgba(255,215,0,0.4); }
    @keyframes collectPop { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; } 50% { transform: translate(-50%, -50%) scale(1); } 100% { transform: translate(-50%, -100%) scale(0.8); opacity: 0; } }

    .mission-notif { position: fixed; top: 1rem; right: 1rem; background: linear-gradient(135deg, var(--mint) 0%, var(--lavender) 100%); padding: 0.8rem 1.2rem; border-radius: 1rem; font-weight: 600; color: var(--text-dark); z-index: 160; animation: slideInRight 3s ease-out forwards; box-shadow: 0 4px 20px rgba(0,0,0,0.2); max-width: 200px; text-align: center; font-size: 0.9rem; }
    .mission-notif-icon { font-size: 1.5rem; display: block; margin-bottom: 0.3rem; }
    @keyframes slideInRight { 0% { transform: translateX(120%); opacity: 0; } 10% { transform: translateX(0); opacity: 1; } 85% { transform: translateX(0); opacity: 1; } 100% { transform: translateX(120%); opacity: 0; } }

    @media (hover: none) and (pointer: coarse) {
      .desktop-only { display: none !important; }
      .location-badge,
      .progress-container,
      .collectibles-badge,
      .music-controls,
      .icon-btn,
      #minimap {
        backdrop-filter: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      }
      .music-btn {
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      }
      .joystick-ripple {
        display: none;
      }
    }

    @media (max-width: 380px) {
      .splash-title { font-size: 2.2rem; }
      .splash-crown { font-size: 4.5rem; }
      #minimap { padding: 0.6rem 1rem; gap: 0.5rem; }
      .map-icon { width: 32px; height: 32px; font-size: 1rem; }
    }

    /* Phase 5 Polish - Additional floating message animations */

    /* War cry messages (Tea vs Coffee) */
    .war-cry {
      background: transparent !important;
      box-shadow: none !important;
      font-size: 1.2rem !important;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      animation: warCryPulse 3.5s ease-out forwards !important;
    }
    .war-cry::after { display: none; }
    @keyframes warCryPulse {
      0% { opacity: 0; transform: translateX(-50%) scale(0.5); }
      15% { opacity: 1; transform: translateX(-50%) scale(1.2); }
      30% { transform: translateX(-50%) scale(1); }
      80% { opacity: 1; }
      100% { opacity: 0; transform: translateX(-50%) translateY(-40px) scale(0.8); }
    }

    /* Doom Sayer prophecy messages */
    .doom-quote {
      background: linear-gradient(135deg, #2d0a0a 0%, #4a1010 100%) !important;
      color: #ff4444 !important;
      border: 2px solid #8b0000;
      box-shadow: 0 0 20px rgba(139, 0, 0, 0.5) !important;
      animation: doomFloat 4s ease-out forwards !important;
    }
    .doom-quote::after {
      border-top-color: #4a1010 !important;
    }
    @keyframes doomFloat {
      0% { opacity: 0; transform: translateX(-50%) scale(0.8); }
      10% { opacity: 1; transform: translateX(-50%) scale(1.1); }
      20% { transform: translateX(-50%) scale(1); }
      25% { transform: translateX(calc(-50% - 5px)) rotate(-2deg); }
      30% { transform: translateX(calc(-50% + 5px)) rotate(2deg); }
      35% { transform: translateX(calc(-50% - 3px)) rotate(-1deg); }
      40% { transform: translateX(-50%) rotate(0deg); }
      80% { opacity: 1; }
      100% { opacity: 0; transform: translateX(-50%) translateY(-30px); }
    }

    /* Bounce quote (trampoline) */
    .bounce-quote {
      background: transparent !important;
      font-size: 2rem !important;
      font-weight: bold;
      text-shadow: 2px 2px 4px white, -1px -1px 2px white;
      pointer-events: none;
      animation: bounceQuote 1.5s ease-out forwards !important;
    }
    @keyframes bounceQuote {
      0% { opacity: 1; transform: translateX(-50%) scale(0.5); }
      30% { transform: translateX(-50%) scale(1.3); }
      50% { transform: translateX(-50%) scale(1); }
      100% { opacity: 0; transform: translateX(-50%) scale(1) translateY(-60px); }
    }

    /* Fighter/Boxing quotes */
    .fighter-quote {
      background: linear-gradient(135deg, #1a1a1a 0%, #333 100%) !important;
      color: #ffd700 !important;
      border: 2px solid #ffd700;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3) !important;
    }
    .fighter-quote::after {
      border-top-color: #333 !important;
    }

    /* King Ben royal quote */
    .king-quote {
      background: linear-gradient(135deg, #4b0082 0%, #800080 100%) !important;
      color: #ffd700 !important;
      border: 2px solid #ffd700;
      box-shadow: 0 4px 20px rgba(75, 0, 130, 0.5), 0 0 10px rgba(255, 215, 0, 0.3) !important;
    }
    .king-quote::after {
      border-top-color: #800080 !important;
    }

    /* NPC interaction zoom transition overlay */
    .zoom-transition-overlay {
      position: fixed;
      inset: 0;
      background: transparent;
      pointer-events: none;
      z-index: 50;
    }

    /* Dialog appear animation enhancement */
    #dialog-overlay.visible .dialog-card {
      animation: dialogZoomIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }
    @keyframes dialogZoomIn {
      0% { opacity: 0; transform: scale(0.8) translateY(20px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }

    /* Fishing result messages */
    .fishing-success {
      background: linear-gradient(135deg, #228b22 0%, #32cd32 100%) !important;
      color: white !important;
      animation: fishCatch 3s ease-out forwards !important;
    }
    .fishing-miss {
      background: linear-gradient(135deg, #cd5c5c 0%, #ff6347 100%) !important;
      color: white !important;
    }
    @keyframes fishCatch {
      0% { opacity: 0; transform: translateX(-50%) translateY(20px) rotate(-5deg); }
      20% { opacity: 1; transform: translateX(-50%) translateY(-10px) rotate(5deg); }
      40% { transform: translateX(-50%) translateY(0) rotate(-3deg); }
      60% { transform: translateX(-50%) translateY(-5px) rotate(2deg); }
      80% { opacity: 1; transform: translateX(-50%) translateY(0) rotate(0); }
      100% { opacity: 0; transform: translateX(-50%) translateY(-30px); }
    }

    /* Float up animation for messages */
    @keyframes floatUp {
      0% { opacity: 0; transform: translateX(-50%) translateY(10px); }
      15% { opacity: 1; transform: translateX(-50%) translateY(0); }
      80% { opacity: 1; }
      100% { opacity: 0; transform: translateX(-50%) translateY(-30px); }
    }

    /* Romantic heart float animation */
    @keyframes heartFloat {
      0% { opacity: 0; transform: translateY(0) scale(0.5); }
      20% { opacity: 1; transform: translateY(-20px) scale(1); }
      80% { opacity: 1; }
      100% { opacity: 0; transform: translateY(-80px) scale(0.8); }
    }

    .romantic-heart {
      filter: drop-shadow(0 2px 4px rgba(255, 0, 100, 0.4));
    }

    /* Guard reaction style */
    .guard-reaction {
      background: rgba(255, 255, 255, 0.85) !important;
      padding: 0.3rem 0.6rem !important;
      border-radius: 0.5rem !important;
      border: 1px solid #888 !important;
    }
